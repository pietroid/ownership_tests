## Use this workflow to begin the release process by bumping the version on the development branch.
name: Begin release process ðŸš€

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  bump-version:
    name: Bump version on development
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Bump version on development branch
        run: |
          git checkout development
          git pull origin development
          git checkout -b bump-version

          cd scripts
          ./bump_version.sh
          ./bump_flutter_version.sh

          cd ..

          git add version.txt pubspec.yaml

          CURRENT_VERSION=$(cat version.txt)
          echo "CURRENT_VERSION=$CURRENT_VERSION" >> $GITHUB_ENV

          git commit -m "Release: Bump version to $CURRENT_VERSION"
          git push origin bump-version --force

      - name: Create PR (bump-version â†’ development)
        run: |
          # Close existing PR if it exists
          existing_pr=$(gh pr list -B development -H bump-version --json number --jq '.[0].number')
          if [ -n "$existing_pr" ]; then
            gh pr close "$existing_pr"
          fi
          gh pr create -B development -H bump-version --title "Release: Bump version to $CURRENT_VERSION" --body "Automated version bumping for incoming release $CURRENT_VERSION"
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}